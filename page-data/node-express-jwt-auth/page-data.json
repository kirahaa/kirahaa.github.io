{"componentChunkName":"component---src-templates-blog-post-js","path":"/node-express-jwt-auth/","result":{"data":{"site":{"siteMetadata":{"title":"Kirahaa"}},"markdownRemark":{"id":"b54a6070-dbd7-5ce7-ac9c-21d9aad67db7","excerpt":"Node.jsì™€ Express, Mongodbë¥¼ ì´ìš©í•œ JWT í† í° ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬í˜„ í•œ ë’¤, AWS ec2ë¥¼ í†µí•´ ë°°í¬í•œ ë‚´ìš©ì„ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤. 1. í”„ë¡œì íŠ¸ ìƒì„± ë° ì„¤ì •í•˜ê¸° ìƒˆë¡œìš´ ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“  í›„, package.json íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•´ì£¼ê³ , npmâ€¦","html":"<blockquote>\n<p>Node.jsì™€ Express, Mongodbë¥¼ ì´ìš©í•œ JWT í† í° ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬í˜„ í•œ ë’¤, AWS ec2ë¥¼ í†µí•´ ë°°í¬í•œ ë‚´ìš©ì„ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n</blockquote>\n<hr>\n<h2>1. í”„ë¡œì íŠ¸ ìƒì„± ë° ì„¤ì •í•˜ê¸°</h2>\n<p>ìƒˆë¡œìš´ ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“  í›„, package.json íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•´ì£¼ê³ , <code>npm install</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ í”„ë¡œì íŠ¸ì— í•„ìš”í•œ ëª¨ë“ˆì„ ì„¤ì¹˜í•´ ì¤ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"json\"  >\n          <code slot=\"code\">// package.json\r\n{\r\n  &quot;name&quot;: &quot;express-jwt-auth&quot;,\r\n  &quot;version&quot;: &quot;1.0.0&quot;,\r\n  &quot;description&quot;: &quot;auth with express jwt&quot;,\r\n  &quot;main&quot;: &quot;index.js&quot;,\r\n  &quot;dependencies&quot;: {\r\n    &quot;bcrypt&quot;: &quot;^5.0.0&quot;,\r\n    &quot;cookie-parser&quot;: &quot;^1.4.5&quot;,\r\n    &quot;ejs&quot;: &quot;^3.1.3&quot;,\r\n    &quot;express&quot;: &quot;^4.17.1&quot;,\r\n    &quot;jsonwebtoken&quot;: &quot;^8.5.1&quot;,\r\n    &quot;mongoose&quot;: &quot;^5.9.23&quot;,\r\n    &quot;validator&quot;: &quot;^13.1.1&quot;\r\n  },\r\n  &quot;scripts&quot;: {\r\n    &quot;start&quot;: &quot;node app.js&quot;,\r\n    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;\r\n  },\r\n  &quot;keywords&quot;: [\r\n    &quot;auth&quot;,\r\n    &quot;express&quot;,\r\n    &quot;jwt&quot;\r\n  ],\r\n  &quot;author&quot;: &quot;hayeong&quot;,\r\n  &quot;license&quot;: &quot;ISC&quot;\r\n}</code>\n        </deckgo-highlight-code>\n<h3>ë””ë ‰í† ë¦¬ êµ¬ì¡°</h3>\n<p>í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  ë””ë ‰í† ë¦¬ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\r\ní˜ì´ì§€ í…œí”Œë¦¿ì€ <code>ejs</code>ë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">â”œâ”€ .gitignore\r\nâ”œâ”€ README.md\r\nâ”œâ”€ app.js\r\nâ”œâ”€ config.example.js\r\nâ”œâ”€ controllers\r\nâ”‚  â””â”€ authController.js\r\nâ”œâ”€ middleware\r\nâ”‚  â””â”€ authMiddleware.js\r\nâ”œâ”€ models\r\nâ”‚  â””â”€ User.js\r\nâ”œâ”€ package.json\r\nâ”œâ”€ public\r\nâ”‚  â””â”€ style.css\r\nâ”œâ”€ routes\r\nâ”‚  â””â”€ authRoutes.js\r\nâ””â”€ views\r\n   â”œâ”€ detail.ejs\r\n   â”œâ”€ home.ejs\r\n   â”œâ”€ login.ejs\r\n   â”œâ”€ partials\r\n   â”‚  â”œâ”€ footer.ejs\r\n   â”‚  â””â”€ header.ejs\r\n   â””â”€ signup.ejs</code>\n        </deckgo-highlight-code>\n<p>Â©generated by <a href=\"https://woochanleee.github.io/project-tree-generator\">Project Tree Generator</a></p>\n<h3>app.js ì„¸íŒ…í•˜ê¸°</h3>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// app.js\r\nconst express = require(&#39;express&#39;);\r\nconst mongoose = require(&#39;mongoose&#39;);\r\n\r\nconst config = require(&#39;./config&#39;)\r\n\r\nconst app = express();\r\n\r\n// middleware\r\napp.use(express.static(&#39;public&#39;));\r\n\r\n// view engine\r\napp.set(&#39;view engine&#39;, &#39;ejs&#39;);\r\n\r\nmongoose.connect(config.mongodbUri)\r\nconst db = mongoose.connection\r\ndb.on(&#39;error&#39;, console.error)\r\ndb.once(&#39;open&#39;, ()=&gt;{\r\n    console.log(&#39;connected to mongodb server&#39;)\r\n    app.listen(3000)\r\n})\r\n\r\n// routes\r\napp.get(&#39;/&#39;, (req, res) =&gt; res.render(&#39;home&#39;));</code>\n        </deckgo-highlight-code>\n<p><code>config.js</code> íŒŒì¼ì€ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  MongoDB ì„œë²„ì˜ ì •ë³´ì™€, JWT í† í°ì„ ë§Œë“¤ ë•Œ ì‚¬ìš©ë  <code>secret</code> í‚¤ì˜ ì •ë³´ë¥¼ ì§€ë‹ˆê³  ìˆìŠµë‹ˆë‹¤.</p>\n<p>ë³´ì•ˆì— ê´€ë ¨ëœ ì •ë³´ëŠ” ë”°ë¡œ íŒŒì¼ì— ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.\r\ngithub ì €ì¥ì†Œì—ë„ <code>config.js</code> íŒŒì¼ì€ <code>.gitignore</code>ì— ì¶”ê°€í•´ì„œ ì»¤ë°‹ì´ ë˜ì§€ ì•Šë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.\r\nì˜ˆì œ ì •ë³´ê°€ ì í˜€ìˆëŠ” <code>config.example.js</code> íŒŒì¼ì˜ ì´ë¦„ì„ <code>config.js</code>ë¡œ ìˆ˜ì •í•˜ê³  ì‚¬ìš©í•©ë‹ˆë‹¤.\r\nì„¤ì • íŒŒì¼ì„ ì‘ì„±í•˜ê¸° ì „ì—, MongoDB ì„œë²„ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.</p>\n<h2>2. MongoDB ì¤€ë¹„</h2>\n<p><a href=\"https://www.mongodb.com/\">MongoDB í™ˆí˜ì´ì§€</a>ì— ë“¤ì–´ê°€ì„œ íšŒì›ê°€ì…ì„ í•´ ì¤ë‹ˆë‹¤.<br/>\r\nìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ê³  ìƒˆë¡œìš´ í´ëŸ¬ìŠ¤í„°ë¥¼ ë§Œë“­ë‹ˆë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f2c905606f20f08dad165fad974c1fa9/9caaa/mongodb_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABTklEQVR42oWS3W4VIRSF5/2fxBfwAbzyRi+MNyYmtqYxaU87TGf42xvYfAZOzrGapi6yMgOEzbeAZYuemDJpuAheEiqClkKzRv9P01rIRUkiiCrL/e54OnZa7/zcPD/czmlPBMlkVXrvbxvOto41Y/m+3nPrHatEnD9w3vPod9wgL8JbGgWHbtcH3n36wMebbyynzXHkSLVGbUapDVWdkYdHjOFa65XqgjWohn49r7z/+pkvdzcsj84RUqJZRWsnqhEl4WO8+jzf/qZ70QyjtI4ZLA/bOgn/XfBSpVZ8zPiQiClhZvRX4lvvI/JGzGlGfk3NDCmVI1V8UkSU1ux6fn+Iz0WXk3Nsxz4pQjpHjHncsHCEMPuicnbRSXh4jw+BmIUjpvkd64eXp23jOQZqq/MtjfMahUJO+BTn/9jgstEYv4xFUXxWguh8j7U1fgN2Yb6VbYCypwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"make new cluster in mongodb\"\n        title=\"\"\n        src=\"/static/f2c905606f20f08dad165fad974c1fa9/984b6/mongodb_1.png\"\n        srcset=\"/static/f2c905606f20f08dad165fad974c1fa9/4d6f2/mongodb_1.png 158w,\n/static/f2c905606f20f08dad165fad974c1fa9/3c1ae/mongodb_1.png 315w,\n/static/f2c905606f20f08dad165fad974c1fa9/984b6/mongodb_1.png 630w,\n/static/f2c905606f20f08dad165fad974c1fa9/e7d8e/mongodb_1.png 945w,\n/static/f2c905606f20f08dad165fad974c1fa9/58c38/mongodb_1.png 1260w,\n/static/f2c905606f20f08dad165fad974c1fa9/9caaa/mongodb_1.png 2874w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ì €ëŠ” <code>Project 0</code>ì˜ <code>myCluster</code>ë€ ì´ë¦„ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ë§Œë“¤ì–´ ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>\n<h3>ë°ì´í„° ë² ì´ìŠ¤ ë§Œë“¤ê¸°</h3>\n<p><strong>Browse Collections > add my own data</strong>ì—ì„œ ìƒˆë¡œìš´ ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0fce7eaf88640a4114d10bcb5b96e403/f621c/mongodb_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAUlEQVR42n2SS2sTURiG8y8FE5smk3vakHYyk7lP0napuFaKUSuohbSQpRsX7rSCWkttWkQkVVDT2NDQC9M88p20RUU8cJgzw5z3e28xzfTQDI9s3UfOGdMnVw/IWyEFu/HfLf9kzYBsPSBj+JS9RWJp3aVgNZg2fOK6S9oISNcCNMMnL8B2qC7KkH8NKl48s6bPjAAmdBvN9NWe0h1Shk9yzuH28gPe7+zy6u0mr99tsfmhS/fjJ27eaZHSHYpOU7ETZqJQq3mU3UViSd1RYDJdZBecBlNVi0drHUZHI/r9A06Oj4mic2S1VteIVwxKTvOKtex0zVXfYpmaR74eKu9S8w5azeVGxWRlrcPXwYjewZDh2ZgfRyecKcB1pqp1Sm7zSnbG8EhWLYp2c+LhBFDCcZVHcuFhu0OvP2Tvy3f6o1MOTyMiYPlJm+szNXLK1/CCaaiIzHhLxLQLhmnTI2cHlL0FJXml3eFwOORzb5+DwYAoipTke0/bJGYNFUbODIhXTRJzFtNzNiVngVh63lUTLtMruQuKoXgo63w8hjF8+zng5f4u91fXiSvAJnkz4NqsTqJqkTXDScoCKAwv/RAJkqKkvNXd483WNpvbO7zY2ODx82fcuttSbC57WLKbE7b1YCJZaMvL36WVskodpBZSj4IVUvGWlJo/yv1byYXhLw/sDdyHZaEEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"make database in mongodb\"\n        title=\"\"\n        src=\"/static/0fce7eaf88640a4114d10bcb5b96e403/984b6/mongodb_2.png\"\n        srcset=\"/static/0fce7eaf88640a4114d10bcb5b96e403/4d6f2/mongodb_2.png 158w,\n/static/0fce7eaf88640a4114d10bcb5b96e403/3c1ae/mongodb_2.png 315w,\n/static/0fce7eaf88640a4114d10bcb5b96e403/984b6/mongodb_2.png 630w,\n/static/0fce7eaf88640a4114d10bcb5b96e403/e7d8e/mongodb_2.png 945w,\n/static/0fce7eaf88640a4114d10bcb5b96e403/58c38/mongodb_2.png 1260w,\n/static/0fce7eaf88640a4114d10bcb5b96e403/f621c/mongodb_2.png 2878w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ì €ëŠ” ë°ì´í„° ë² ì´ìŠ¤ ì´ë¦„ì„ <code>node-auth</code>ë¡œ ì„¤ì •í•˜ê³ , collection ì´ë¦„ì„ <code>users</code>ë¡œ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.<br/>\r\nì„¤ì •ì´ ëë‚˜ë©´ <strong>Connect > Connect to your application > Drivers</strong> í•´ë‹¹ ë°ì´í„° ë² ì´ìŠ¤ì— ì—°ê²°í•˜ë©´ í•˜ë‹¨ì— <strong>application code</strong>ê°€ ë‚˜ì˜µë‹ˆë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a76ab49290854c5fad78ba9fdfb20274/a58ca/mongodb_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACGUlEQVR42mWSyW4TQRRF+/tYsWCD2KCwQMSZbHe7J/fk+HdYAd6Q4HbyIYgkKHFit93ueTyoKyRE4klPqnoqnbr36Uq6YWCYJrZtM5CHfJ3NuH9YcXV1za+ra5bLe7abDZtgQ7Bei16vVkRRxGw2Q1U1LNvGMAwc10EaqCMUXcPxPD70DjnzF3R1F2+Iy5y2bYnrgrDMxLy7Z2UpzovFAk3TmEwmTFyP6ekU6WikcKJraLbFwfERc98nTBJ+3txwfXtHsA3Jq5K0yKmbhqZpSPNcAH3fxzQMjpQhr/fe8bF/iKSoKrpp4noesqww9xckaS5s3y0fiKKYsiyFsqfqoE8KDV1nZOq8P9xnoKlII1UTO3Rdl+PBkPP5gqZtyfOcXZxQlBV1U1PV9TPoJVBVVRzXZWw5nHaWZXX0qND12O/1+H52xnYX8fv2ll0cU1YVnbjO7pPKl0BZlrEsG8uy8CYekjzqLI/xPI9Xb9/w+dsX8XgbJ2RFSdm0VE0rVFed0qamqMrnHWqajuN6jC0bbzJBGsgKqhi6fDrocT73SUtYBhHrMGEdpgRhQpbl/+3wx9znpC9jjC3M8ViAJU3XheUOOBgMWVxckBUF62BDGEXESUKapsRpSl4UwnpVV3+Bc2RFETnsLE+nU6Qu2KY1xnYc+v0+F5eXFG3Dchuw3e2Is4wwT0iyTHT3WZT9y6GuP+ZQ0w329g/4A2A1hlEen3jlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Connect to cluster in mongodb\"\n        title=\"\"\n        src=\"/static/a76ab49290854c5fad78ba9fdfb20274/984b6/mongodb_3.png\"\n        srcset=\"/static/a76ab49290854c5fad78ba9fdfb20274/4d6f2/mongodb_3.png 158w,\n/static/a76ab49290854c5fad78ba9fdfb20274/3c1ae/mongodb_3.png 315w,\n/static/a76ab49290854c5fad78ba9fdfb20274/984b6/mongodb_3.png 630w,\n/static/a76ab49290854c5fad78ba9fdfb20274/e7d8e/mongodb_3.png 945w,\n/static/a76ab49290854c5fad78ba9fdfb20274/58c38/mongodb_3.png 1260w,\n/static/a76ab49290854c5fad78ba9fdfb20274/a58ca/mongodb_3.png 2876w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><strong>application code ì˜ˆì‹œ</strong></p>\n<p>mongodb+srv://&#x3C;ë³¸ì¸ ì•„ì´ë””>:&#x3C;íŒ¨ìŠ¤ì›Œë“œ>@mycluster.likcia7.mongodb.net/?retryWrites=true&#x26;w=majority</p>\n</blockquote>\n<h2>3. MongoDB ì—°ê²°í•˜ê¸°</h2>\n<h3>config.js ì„¸íŒ…í•˜ê¸°</h3>\n<p>ìœ„ì—ì„œ ìƒì„±í•œ <strong>application code</strong>ë¥¼ ë³µì‚¬ ë¶™ì—¬ë„£ê¸° í•´ ì¤ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">module.exports = {\r\n  &#39;secret&#39;: &#39;SeCrEtKeYfOrHaShInG&#39;,\r\n  &#39;mongodbUri&#39;: &#39;mongodb+srv://&lt;ë³¸ì¸ ì•„ì´ë””&gt;:&lt;íŒ¨ìŠ¤ì›Œë“œ&gt;@mycluster.likcia7.mongodb.net/?retryWrites=true&amp;w=majority&#39;\r\n}</code>\n        </deckgo-highlight-code>\n<p><code>secret</code> í‚¤ëŠ” ì´í›„ì— JWT í† í°ì„ ê²€ì¦í•˜ëŠ” ì„œëª… ë¶€ë¶„ì— ì‚¬ìš©í•  ë¹„ë°€ í‚¤ì…ë‹ˆë‹¤. ë³´ì•ˆì— ì—°ê´€ëœ ì •ë³´ë“¤ì€ config.js íŒŒì¼ì— ë³´ê´€í•´ ì¤ë‹ˆë‹¤.</p>\n<p>ì—¬ê¸°ê¹Œì§€ ì½”ë“œì‘ì„±ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´, í„°ë¯¸ë„ì—ì„œ <code>node app.js</code>ë¥¼ ì…ë ¥í•˜ì—¬ ì„œë²„ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"shell\"  >\n          <code slot=\"code\">&gt; node app.js\r\n\r\nconnected to mongodb server // ì´ë ‡ê²Œ ëœ¨ë©´ ì„±ê³µ! ğŸ‰</code>\n        </deckgo-highlight-code>\n<h2>4. ë³¸ê²© API ë§Œë“¤ê¸°</h2>\n<h3>Auth Routes</h3>\n<p>ì¸ì¦ì— ê´€ë ¨ëœ ë¼ìš°í„°ë¥¼ êµ¬ì„±í•´ ì¤ë‹ˆë‹¤.</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">route</th>\n<th align=\"left\">request</th>\n<th align=\"right\">description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\"><strong>/signup</strong></td>\n<td align=\"left\">GET</td>\n<td align=\"right\">sign up page</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>/login</strong></td>\n<td align=\"left\">GET</td>\n<td align=\"right\">login page</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>/signup</strong></td>\n<td align=\"left\">POST</td>\n<td align=\"right\">create a new user in db</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>/login</strong></td>\n<td align=\"left\">POST</td>\n<td align=\"right\">authenticate a current user</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>/logout</strong></td>\n<td align=\"left\">GET</td>\n<td align=\"right\">logout page</td>\n</tr>\n</tbody>\n</table>\n<p><code>authRoutes.js</code> íŒŒì¼ì„ ìƒì„±í•œ í›„, ë‹¤ìŒê³¼ ê°™ì´ ë¼ìš°í„°ë¥¼ ì„¤ì •í•´ ì¤ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// routes/authRoutes.js\r\nconst { Router } = require(&#39;express&#39;);\r\n\r\nconst router = Router();\r\n\r\nrouter.get(&#39;/signup&#39;, () =&gt; {});\r\nrouter.post(&#39;/signup&#39;, () =&gt; {});\r\nrouter.get(&#39;/login&#39;, () =&gt; {});\r\nrouter.post(&#39;/login&#39;, () =&gt; {});\r\nrouter.get(&#39;/logout&#39;, () =&gt; {})\r\n\r\nmodule.exports = router;</code>\n        </deckgo-highlight-code>\n<h3>ì»¨íŠ¸ë¡¤ëŸ¬</h3>\n<p>ì´ì œ ê°ê°ì˜ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// controllers/authController.js\r\n\r\nmodule.exports.signup_get = (req, res) =&gt; {\r\n\tres.render(&#39;signup&#39;)\r\n}\r\n\r\nmodule.exports.login_get = (req, res) =&gt; {\r\n\tres.render(&#39;login&#39;)\r\n}\r\n\r\nmodule.exports.signup_post = (req, res) =&gt; {\r\n\tres.send(&#39;new signup&#39;)\r\n}\r\n\r\nmodule.exports.login_post = (req, res) =&gt; {\r\n\tres.send(&#39;user login&#39;)\r\n}</code>\n        </deckgo-highlight-code>\n<p>êµ¬ì„±í•œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ routerì— ì—°ê²°í•©ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// routes/authRoutes.js\r\n\r\nconst {Router} = require(&#39;express&#39;);\r\nconst authController = require(&#39;../controllers/authController&#39;);\r\n\r\nconst router = Router();\r\n\r\nrouter.get(&#39;/signup&#39;, authController.signup_get);\r\nrouter.post(&#39;/signup&#39;, authController.signup_post);\r\nrouter.get(&#39;/login&#39;, () =&gt; authController.login_get);\r\nrouter.post(&#39;/login&#39;, () =&gt; authController.login_post);\r\n\r\n\r\nmodule.exports = router;</code>\n        </deckgo-highlight-code>\n<p><code>app.js</code>ì—ë„ ì´ ë¼ìš°í„°ë“¤ì„ ì—°ê²°í•´ ì¤ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">...\r\nconst authRoutes = require(&#39;./routes/authRoutes&#39;);\r\n...\r\n\r\napp.use(authRoutes);</code>\n        </deckgo-highlight-code>\n<h2>5. Postmanì„ ì´ìš©í•œ API í…ŒìŠ¤íŠ¸</h2>\n<p><a href=\"https://www.postman.com/\">Postman</a>ì€ í”„ë¡ íŠ¸ì—”ë“œê°€ êµ¬í˜„ë˜ê¸° ì „ì— ì„œë²„ì— ëŒ€í•œ ìš”ì²­ì„ ì‹œë®¬ë ˆì´ì…˜í•  ìˆ˜ ìˆëŠ” í”Œë«í¼ì…ë‹ˆë‹¤.<br/>\r\nì´ë¥¼ í†µí•´ ê°œë°œí•œ APIë¥¼ í…ŒìŠ¤íŠ¸í•˜ê³ , í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ê³µìœ í•˜ì—¬ API ê°œë°œì˜ ìƒì‚°ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f6d933c1ad2dcad32db2f3e6bacb358e/f9c26/postman.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABf0lEQVR42pVSy47UMBDMT3BjFL8dP5I4yTjZeIEs3JA48zH8fKF2dqJBggOHkl3q7nJ1t5uUEuZpgrUW3ntM0wTnHJRSEFJCKgVjDKYxYh4itJLgQoC3N7D0BjkWpGgRNENnDRrvA3xM6Pu+ClXhECofhqFyEpdSQGtV7yc0JLvBGQkTZ4hPPyHDjCbnjLTcsb1s2LYN5DgNA8K76DiO9YGu6y6QY601lLbVsYwZH3/8AusLmnleEKJDKTuO4w3DOMIaDWsN2rYFY6yijkCIi9OdRBnjYO0N+vYBirdoKNE4i7yu2PcdMUZwzmsBnQ/8jVPtyQWEpAclGrLfeYdlWTDPc22Jkh5OCM9CFYzwHmP8yqezClpncc+5OiTR4B1c19WFUPxcirwEafNSK0ianz5/AsXJdaOVge80XtYVpZTqNHhfN26svURpXs/tPsDFyS9BFz1CirjvGeX1Feu61qLnhfyz9Sc8FtXcvxWs3z+jPzK+fD1wHMcfbv4HJPgbj0Mjf3elS8EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Postman\"\n        title=\"\"\n        src=\"/static/f6d933c1ad2dcad32db2f3e6bacb358e/984b6/postman.png\"\n        srcset=\"/static/f6d933c1ad2dcad32db2f3e6bacb358e/4d6f2/postman.png 158w,\n/static/f6d933c1ad2dcad32db2f3e6bacb358e/3c1ae/postman.png 315w,\n/static/f6d933c1ad2dcad32db2f3e6bacb358e/984b6/postman.png 630w,\n/static/f6d933c1ad2dcad32db2f3e6bacb358e/e7d8e/postman.png 945w,\n/static/f6d933c1ad2dcad32db2f3e6bacb358e/58c38/postman.png 1260w,\n/static/f6d933c1ad2dcad32db2f3e6bacb358e/f9c26/postman.png 2880w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Postmanì„ í†µí•´ ìƒì„±í•œ api ì£¼ì†Œë¡œ ê° ìš”ì²­ì„ ë³´ë‚´ ì—°ê²°ì´ ì˜ ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h2>6. model</h2>\n<p><code>mongoose</code>ë¥¼ í†µí•´ ìœ ì € ì •ë³´ë¥¼ MongoDBì— ë„£ì„ë•Œ, ìŠ¤í‚¤ë§ˆë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.<br/>\r\nìŠ¤í‚¤ë§ˆë€ ê¸°ë³¸ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ë°ì´í„°ë‚˜ ê¸°ë¡ì´ ì–´ë–»ê²Œ í‘œì‹œë˜ì–´ì•¼ í•˜ëŠ”ì§€ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.<br/>\r\ní•´ë‹¹ íŒŒíŠ¸ì—ì„œ ìœ íš¨ì„± ë¬¸êµ¬ ë“±ì„ ì§ì ‘ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// models/User.js\r\n\r\nconst mongoose = require(&#39;mongoose&#39;);\r\nconst { isEmail } = require(&#39;validator&#39;);\r\n\r\nconst userSchema = new mongoose.Schema({\r\n\temail: {\r\n\t\ttype: String,\r\n\t\trequired: [true, &#39;Please enter an email&#39;],\r\n\t\tunique: true,\r\n\t\tlowercase: true,\r\n\t\tvalidate: [isEmail, &#39;Please enter a valid email&#39;]\r\n\t},\r\n\tpassword: {\r\n\t\ttype: String,\r\n\t\trequired: [true, &#39;Please enter a password&#39;],\r\n\t\tminlength: [6, &#39;Minimum password length is 6 characters&#39;]\r\n\t},\r\n});\r\n\r\nconst User = mongoose.model(&#39;user&#39;, userSchema);\r\n\r\nmodule.exports = User;</code>\n        </deckgo-highlight-code>\n<p>ë‹¤ì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ëŒì•„ê°€ì„œ ìœ ì € ëª¨ë¸ì„ ì—°ê²°í•´ ì¤ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// controllers/authController.js\r\nconst User = require(&#39;../models/User&#39;);\r\n\r\n// handle errors\r\nconst handleErrors = (err) =&gt; {\r\n\tconsole.log(err.message, err.code);\r\n\tlet error = { email: &#39;&#39;, password: &#39;&#39;};\r\n\r\n\t// duplicate error code\r\n\tif (err.code === 11000) {\r\n\t\terrors.email = &#39;that email is aleady registered&#39;;\r\n\t\treturn errors;\r\n\t}\r\n\r\n\t// validation errors\r\n\tif (err.message.includes(&#39;user validation failed&#39;)) {\r\n\t\tObject.values(err.errors).forEach(({properties}) =&gt; {\r\n\t\t\terror[properties.path] = properties.message;\r\n\t\t})\r\n\t}\r\n\r\n\treturn errors;\r\n}\r\n\r\nmodule.exports.signup_get = (req, res) =&gt; {\r\n\tres.render(&#39;signup&#39;)\r\n}\r\n\r\nmodule.exports.login_get = (req, res) =&gt; {\r\n\tres.render(&#39;login&#39;)\r\n}\r\n\r\nmodule.exports.signup_post = async (req, res) =&gt; {\r\n\tconst {email, password} = req.body;\r\n\r\n\ttry {\r\n\t\tconst user = await User.create({ email, password }); // ìœ ì € ìƒì„±\r\n\t\tres.status(201).json(user);\r\n\t}\r\n\tcatch (err) {\r\n\t\tconst errors = handleErrors(err);\r\n\t\tres.status(400).json({errors})\r\n\t}\r\n}\r\n\r\nmodule.exports.login_post = async (req, res) =&gt; {\r\n\tconst {email, password} = req.body;\r\n\r\n\tconsole.log(email, password);\r\n\tres.send(&#39;user login&#39;)\r\n}</code>\n        </deckgo-highlight-code>\n<h3>ë¹„ë°€ë²ˆí˜¸ í•´ì‹œì²˜ë¦¬</h3>\n<p>í˜„ì¬ ìœ ì €ì •ë³´ê°€ DBì— ì˜ ìŒ“ì´ê³  ìˆëŠ”ë°, ë¹„ë°€ë²ˆí˜¸ê°€ ê·¸ëŒ€ë¡œ ë“œëŸ¬ë‚˜ê³  ìˆìŠµë‹ˆë‹¤.<br/>\r\nì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´, <code>bcrypt</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™” ì‹œì¼œì¤ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// User.js\r\n\r\nconst mongoose = require(&#39;mongoose&#39;);\r\nconst { isEmail } = require(&#39;validator&#39;);\r\nconst bcrypt = require(&#39;bcrypt&#39;);\r\n\r\nconst userSchema = new mongoose.Schema({\r\n\temail: {\r\n\t\ttype: String,\r\n\t\trequired: [true, &#39;Please enter an email&#39;],\r\n\t\tunique: true,\r\n\t\tlowercase: true,\r\n\t\tvalidate: [isEmail, &#39;Please enter a valid email&#39;]\r\n\t},\r\n\tpassword: {\r\n\t\ttype: String,\r\n\t\trequired: [true, &#39;Please enter a password&#39;],\r\n\t\tminlength: [6, &#39;Minimum password length is 6 characters&#39;]\r\n\t},\r\n});\r\n\r\n// fire a function before doc saved to db\r\nuserSchema.pre(&#39;save&#39;, async function (next) {\r\n\tconst salt = await bcrypt.genSalt();\r\n\tthis.password = await bcrypt.hash(this.password, salt);\r\n\t\r\n\tnext();\r\n})\r\n\r\nconst User = mongoose.model(&#39;user&#39;, userSchema);\r\n\r\nmodule.exports = User;</code>\n        </deckgo-highlight-code>\n<p>ë°ì´í„°ê°€ ì €ì¥ë˜ê¸° ì „ì—(<code>pre</code>) ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹œ ì²˜ë¦¬í•´ì„œ ì•”í˜¸í™” ì‹œì¼œì¤ë‹ˆë‹¤.</p>\n<h3>Cookies</h3>\n<p>ì¿ í‚¤ëŠ” í´ë¼ì´ì–¸íŠ¸ ê°œê°œì¸ì˜ ìƒíƒœ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ë°ì´í„°ì…ë‹ˆë‹¤.<br/>\r\në‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ë¸Œë¼ìš°ì €ì— ì¿ í‚¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// app.js\r\n\r\n// cookies\r\napp.get(&#39;/set-cookies&#39;, (req, res) =&gt; {\r\n\tres.setHeader(&#39;Set-Cookie&#39;, &#39;newUser=true&#39;);\r\n\t// ë˜ëŠ”\r\n\tres.cookie(&#39;newUser&#39;, false);\r\n\t\r\n\tres.send(&#39;you got the cookies!&#39;);\r\n});</code>\n        </deckgo-highlight-code>\n<blockquote>\n<p>ğŸ’¡ ì—¬ê¸°ì„œ ì£¼ì˜í•  ì !</p>\n<p>ì¿ í‚¤ëŠ” javascriptì˜ document.cookieë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, í•´í‚¹ ë‹¹í•  ìœ„í—˜ì´ ìˆë‹¤.\r\nì´ë¥¼ ë³´í˜¸í•˜ê¸° ìœ„í•´ HttOnlyë‚˜ Secure ì†ì„±ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.</p>\n</blockquote>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">res.cookie(&#39;test&#39;, true, { httpOnly: true })</code>\n        </deckgo-highlight-code>\n<p>ì´ë ‡ê²Œ httpOnly ì˜µì…˜ì„ ì¶”ê°€í•˜ë©´, í´ë¼ì´ì–¸íŠ¸ì˜ í™˜ê²½(ì›¹ ë¸Œë¼ìš°ì €)ì—ì„œ ìŠ¤í¬ë¦½íŠ¸(javascript ë“±)ë¡œ ì¿ í‚¤ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ì°¨ë‹¨í•  ìˆ˜ ìˆë‹¤. ì´ ì„¤ì •ì„ í•¨ìœ¼ë¡œì¨ XSS(Cross Site Script) ê³µê²©ì— ëŒ€ì‘ì´ ê°€ëŠ¥í•˜ë‹¤.</p>\n<p>ì¶”ê°€ë¡œ, ì¿ í‚¤ì˜ ë§Œë£Œë‚ ì§œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">const maxAge = 60 * 60 * 24 * 2;  // 60ì´ˆ * 60ë¶„ * 24ì‹œê°„ * 2ì¼\r\n\r\nres.cookie(&#39;jwt&#39;, token, { httpOnly: true, maxAge: maxAge * 1000 })</code>\n        </deckgo-highlight-code>\n<h2>7. JSON Web Tokens</h2>\n<p>JWT(JSON Web Token)ë€ <strong>ì¸ì¦ì— í•„ìš”í•œ ì •ë³´ë“¤ì„ ì•”í˜¸í™”ì‹œí‚¨ JSON í† í°</strong>ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.<br/>\r\nê·¸ë¦¬ê³  JWT ê¸°ë°˜ ì¸ì¦ì€ JWT í† í°(Access Token)ì„ HTTP í—¤ë”ì— ì‹¤ì–´ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹ë³„í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.<br/>\r\nJWTëŠ” .ì„ êµ¬ë¶„ìë¡œ ë‚˜ëˆ„ì–´ì§€ëŠ” ì„¸ ê°€ì§€ ë¬¸ìì—´ì˜ ì¡°í•©ì…ë‹ˆë‹¤.<br/>\r\n.ì„ ê¸°ì¤€ìœ¼ë¡œ <code>Header</code>, <code>Payload</code>, <code>Signature</code>ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a688b3536a0be435f268132ae32083a2/7e08f/jsonwebtoken.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7ElEQVR42mWS204bMRBA+RhYjz2+7C3XTUIpIoQgQi5tIpUi9f9/4lTetISqD2dn5ZGPPeO5KsTxlxtxXIv9FM9c8vlfKaynsHrm0/7MVf6YP4KRSfwsOnZmzFsxZS1jHsKOlT+c0T3taku7OzE8vNFujkhquCnkX+H5RlmsrM2Qb2bC1owZ2Mg0PLAOJ+7Dhqne4b8uqQ+/KDcn0tOeQgPXxlyEWWZFiaJ4sSSjVOJJ4vHGEiUxkI5GRpSmxZuKpBOitERpiFITpMaI58ZYrnKppSRe3TObnnXPzr2wtU/Mxs9MZyduZ2/cdj/ouiOL6Yl5ZrRnMT3SDXdYCX2Pzz3UQOUbWh1QaoMLFdaXJD+mSh0xjZBYUsRA4T2mTEg7PFM3mOAR9eeSjVV8LJlpw522jLQiphrrPcM440taMYm3eF8SywoNJWEwo75/JU3v8NUAmx2hJLt6ofORoSQ6qZhIiQuR4GpGuqDVjrkuGegcq0pcrKhf3ilXR8L8kbBYYasRLlYXodXAoIjMTEljAoXmB6p58Fse/Z5teKeyY4wV3HBBevxOXB5IywNh8YQJNdaFi1B9xKjnRn0fNaS+xHyQ04TT2Pcol5Vvktetj30UI1iXq0yXOcwTb/7D9RR/+FgX95E74z9yeWx+AxitWTHNxlT2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jsonwebtoken\"\n        title=\"\"\n        src=\"/static/a688b3536a0be435f268132ae32083a2/984b6/jsonwebtoken.png\"\n        srcset=\"/static/a688b3536a0be435f268132ae32083a2/4d6f2/jsonwebtoken.png 158w,\n/static/a688b3536a0be435f268132ae32083a2/3c1ae/jsonwebtoken.png 315w,\n/static/a688b3536a0be435f268132ae32083a2/984b6/jsonwebtoken.png 630w,\n/static/a688b3536a0be435f268132ae32083a2/e7d8e/jsonwebtoken.png 945w,\n/static/a688b3536a0be435f268132ae32083a2/7e08f/jsonwebtoken.png 1186w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code>Header</code> ì—ëŠ” JWT ì—ì„œ ì‚¬ìš©í•  íƒ€ì…ê³¼ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ì˜ ì¢…ë¥˜ê°€ ë‹´ê²¨ìˆìœ¼ë©°, <code>Payload</code> ëŠ” ì„œë²„ì—ì„œ ì²¨ë¶€í•œ ì‚¬ìš©ì ê¶Œí•œ ì •ë³´ì™€ ë°ì´í„°ê°€ ë‹´ê²¨ìˆìŠµë‹ˆë‹¤. <code>Signature</code>ì—ëŠ” Header, Payload ë¥¼ Base64 URL-safe Encodeë¥¼ í•œ ì´í›„ Headerì— ëª…ì‹œëœ í•´ì‹œí•¨ìˆ˜ë¥¼ ì ìš©í•˜ê³ , ê°œì¸í‚¤(Private Key)ë¡œ ì„œëª…í•œ ì „ìì„œëª…ì´ ë‹´ê²¨ìˆìŠµë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// controllers/authController.js\r\n...\r\nconst jwt = require(&#39;jsonwebtoken&#39;);\r\n...\r\n\r\nconst maxAge = 3 * 24 * 60 * 60;  // three days\r\nconst createToken = (id) =&gt; {\r\n\treturn jwt.sign({ id }, config.secret, {\r\n\t\texpiresIn: maxAge\r\n\t});\r\n} \r\n\r\n...\r\n\r\nmodule.exports.signup_post = async (req, res) =&gt; {\r\n\tconst {email, password} = req.body;\r\n\r\n\ttry {\r\n\t\tconst user = await User.create({ email, password });\r\n\t\tconst token = createToken(user._id);\r\n\t\tres.cookie(&#39;jwt&#39;, token, { httpOnly: true, maxAge: maxAge * 1000 })\r\n\t\tres.status(201).json({ user: user._id });\r\n\t}\r\n\tcatch (err) {\r\n\t\tconst errors = handleErrors(err);\r\n\t\tres.status(400).json({errors})\r\n\t}\r\n}\r\n...</code>\n        </deckgo-highlight-code>\n<h3>JWTë¥¼ ì´ìš©í•œ ì¸ì¦ ê³¼ì •</h3>\n<ol>\n<li>ì‚¬ìš©ìê°€ ID, PWë¥¼ ì…ë ¥í•˜ì—¬ ì„œë²„ì— ë¡œê·¸ì¸ ì¸ì¦ì„ ìš”ì²­í•œë‹¤.</li>\n<li>ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì¸ì¦ ìš”ì²­ì„ ë°›ìœ¼ë©´, Header, PayLoad, Signatureë¥¼ ì •ì˜í•œë‹¤.Hedaer, PayLoad, Signatureë¥¼ ê°ê° Base64ë¡œ í•œ ë²ˆ ë” ì•”í˜¸í™”í•˜ì—¬ JWTë¥¼ ìƒì„±í•˜ê³  ì´ë¥¼ ì¿ í‚¤ì— ë‹´ì•„ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°œê¸‰í•œë‹¤.</li>\n<li>í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ë¡œë¶€í„° ë°›ì€ JWTë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•œë‹¤. (ì¿ í‚¤ë‚˜ ë‹¤ë¥¸ ê³³ì— ì €ì¥í•  ìˆ˜ë„ ìˆìŒ)APIë¥¼ ì„œë²„ì— ìš”ì²­í• ë•ŒÂ <strong>Authorization headerì— Access Tokenì„ ë‹´ì•„</strong>ì„œ ë³´ë‚¸ë‹¤.</li>\n<li>ì„œë²„ê°€ í•  ì¼ì€ í´ë¼ì´ì–¸íŠ¸ê°€ Headerì— ë‹´ì•„ì„œ ë³´ë‚¸ JWTê°€ ë‚´ ì„œë²„ì—ì„œ ë°œí–‰í•œ í† í°ì¸ì§€ ì¼ì¹˜ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì—¬ ì¼ì¹˜í•œë‹¤ë©´ ì¸ì¦ì„ í†µê³¼ì‹œì¼œì£¼ê³  ì•„ë‹ˆë¼ë©´ í†µê³¼ì‹œí‚¤ì§€ ì•Šìœ¼ë©´ ëœë‹¤.ì¸ì¦ì´ í†µê³¼ë˜ì—ˆìœ¼ë¯€ë¡œ í˜ì´ë¡œë“œì— ë“¤ì–´ìˆëŠ” ìœ ì €ì˜ ì •ë³´ë“¤ì„ selectí•´ì„œ í´ë¼ì´ì–¸íŠ¸ì— ëŒë ¤ì¤€ë‹¤.</li>\n<li>í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ìš”ì²­ì„ í–ˆëŠ”ë°, ë§Œì¼ ì•¡ì„¸ìŠ¤ í† í°ì˜ ì‹œê°„ì´ ë§Œë£Œë˜ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” ë¦¬í”„ë˜ì‹œ í† í°ì„ ì´ìš©í•´ì„œ</li>\n<li>ì„œë²„ë¡œë¶€í„° ìƒˆë¡œìš´ ì—‘ì„¸ìŠ¤ í† í°ì„ ë°œê¸‰ ë°›ëŠ”ë‹¤.</li>\n</ol>\n<h3>ë¼ìš°íŠ¸ ë³´í˜¸í•˜ê¸°</h3>\n<p>ìš”ì²­ì— jwtê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , jwtê°€ ë¬¸ì œê°€ ì—†ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// middleware/authMiddleware.js\r\n\r\nconst jwt = require(&#39;jsonwebtoken&#39;);\r\n\r\nconst config = require(&#39;../config.js&#39;);\r\n\r\nconst requireAuth = (req, res, next) =&gt; {\r\n\tconst token = req.cookies.jwt;\r\n\t\r\n\t// check json web token exists &amp; is verified\r\n\tif (token) {\r\n\t\tjwt.verify(token, config.secret, (err, decodedToken) =&gt; {\r\n\t\t\tif (err) {\r\n\t\t\t\tconsole.log(err.message);\r\n\t\t\t\tres.redirect(&#39;/login&#39;);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(decodedToken);\r\n\t\t\t\tnext();\r\n\t\t\t}\r\n\t\t})\r\n\t} else {\r\n\t\tres.redirect(&#39;/login&#39;);\r\n\t}\r\n}\r\n\r\nmodule.exports = { requireAuth }</code>\n        </deckgo-highlight-code>\n<p>jwt í† í°ì´ ì—†ê±°ë‚˜, ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° login í˜ì´ì§€ë¡œ ë„˜ì–´ê°€ë„ë¡ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•´ ì¤ë‹ˆë‹¤.</p>\n<p>ìœ íš¨í•œ í† í°ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ì— í•´ë‹¹ middlewareë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// app.js\r\n\r\napp.get(&#39;/home&#39;, requireAuth, (req, res) =&gt; res.render(&#39;home&#39;));</code>\n        </deckgo-highlight-code>\n<h2>8. ë¡œê·¸ì•„ì›ƒ</h2>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// AuthController.js\r\n\r\nmodule.exports.logout_get = (req, res) =&gt; {\r\n\tres.cookie(&#39;jwt&#39;, &#39;&#39;, { maxAge: 1 });\r\n\tres.redirect(&#39;/&#39;);\r\n}</code>\n        </deckgo-highlight-code>\n<p>ë¡œê·¸ì•„ì›ƒì€ controllerì—ì„œ jwtë¼ëŠ” í‚¤ë¥¼ ê°€ì§„ ì¿ í‚¤ë¥¼ ì§€ì›Œì¤ë‹ˆë‹¤.</p>\n<h3>í˜„ì¬ ìœ ì € í™•ì¸</h3>\n<p>ejsëŠ” ì„œë²„ë¡œë¶€í„° ë°›ì€ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì´ë¥¼ ìœ„í•´ ë³€ìˆ˜ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// authMiddleware.js\r\n\r\n...\r\n\r\n//check current user\r\nconst checkUser = (req, res, next) =&gt; {\r\n\tconst token = req.cookies.jwt;\r\n\t\r\n\tif (token) {\r\n\t\tjwt.verify(token, config.secret, async (err, decodedToken) =&gt; {\r\n\t\t\tif (err) {\r\n\t\t\t\tconsole.log(err.message);\r\n\t\t\t\tres.locals.user = null;\r\n\t\t\t\tnext();\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(decodedToken);\r\n\t\t\t\tlet user = await User.findById(decodedToken.id);\r\n\t\t\t\tres.locals.user = user;\r\n\t\t\t\tnext();\r\n\t\t\t}\r\n\t\t})\r\n\t} else {\r\n\t\tres.locals.user = null;\r\n\t\tnext();\r\n\t}\r\n}\r\n\r\nmodule.exports = {requireAuth, checkUser};</code>\n        </deckgo-highlight-code>\n<p><code>res.locals.[variable]</code> ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì— ë³€ìˆ˜ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"js\"  >\n          <code slot=\"code\">// app.js\r\nconst { requireAuth, checkUser } = require(&#39;./middleware/authMiddleware&#39;);\r\n\r\n...\r\napp.get(&#39;*&#39;, checkUser); // every single get request\r\n...</code>\n        </deckgo-highlight-code>\n<p>app.jsì— checkUserë¥¼ ê°€ì ¸ì™€ ëª¨ë“ (<code>*</code>) get requestì—ì„œ í˜„ì¬ ìœ ì €ë¥¼ í™•ì¸í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>\n<p>ì—¬ê¸°ì„œ ìƒê¸´ ê¶ê¸ˆì¦!</p>\n<h3>middlewareë€ ë¬´ì—‡ì¸ê°€?</h3>\n<blockquote>\n<p>middlewareì˜ ì‚¬ì „ì  ì •ì˜</p>\n<p>ë¯¸ë“¤ì›¨ì–´ëŠ” ì–‘ ìª½ì„ ì—°ê²°í•˜ì—¬ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆë„ë¡ ì¤‘ê°„ì—ì„œ ë§¤ê°œ ì—­í• ì„ í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´, ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ì„œ ì—°ê²°ëœ ì—¬ëŸ¬ ê°œì˜ ì»´í“¨í„°ì— ìˆëŠ” ë§ì€ í”„ë¡œì„¸ìŠ¤ë“¤ì—ê²Œ ì–´ë–¤ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì—°ê²°í•´ ì£¼ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë§í•œë‹¤. 3ê³„ì¸µ í´ë¼ì´ì–¸íŠ¸/ì„œë²„ êµ¬ì¡°ì—ì„œ ë¯¸ë“¤ì›¨ì–´ê°€ ì¡´ì¬í•œë‹¤. ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ë°ì´í„°ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ì½ì–´ì˜¬ ìˆ˜ ìˆê²Œ ì¤‘ê°„ì— ë¯¸ë“¤ì›¨ì–´ê°€ ì¡´ì¬í•˜ê²Œ ëœë‹¤.</p>\n</blockquote>\n<p>ê´‘ë²”ìœ„í•œ ì„¤ëª…ì´ì§€ë§Œ ë‹¤ìŒ 2ê°œì˜ í‚¤ì›Œë“œê°€ ë¯¸ë“¤ì›¨ì–´ì˜ ì—­í• ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.</p>\n<ol>\n<li>ì–‘ìª½ì„ ì—°ê²°</li>\n<li>ì¤‘ê°„ì—ì„œì˜ ë§¤ê°œ ì—­í• </li>\n</ol>\n<p>í° ë²”ìœ„ë¡œ ë³´ë©´ ë§¤ê°œì²´ ê°„ ì—°ê²°í•´ì£¼ëŠ” ë ˆì´ì–´ë¡œì¨, ë§¤ê°œì²´ëŠ” í´ë¼ì´ì–¸íŠ¸(ì‚¬ìš©ì) - ì„œë²„, ì„œë²„ - ì„œë²„ ê°„ì˜ í†µì‹ ì´ ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.<br/>\r\ní†µìƒì ìœ¼ë¡œ ê¸°ì—…ì—ì„œ ë§í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ í™˜ê²½ì€ ì›¹/ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>\n<p>ejs í…œí”Œë¦¿ì„ ì‚¬ìš©í•œ í”„ë¡ íŠ¸ ë‹¨ì€ ë”°ë¡œ ë‚´ìš©ì— ì‘ì„±í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>\n<p>ëª¨ë“  ì½”ë“œëŠ” <a href=\"https://github.com/kirahaa/auth-with-jwt\">github ë ˆí¬ì§€í† ë¦¬</a> ì°¸ê³  ë¶€íƒë“œë¦½ë‹ˆë‹¤.</p>\n<hr>\n<p>ì—¬ê¸°ê¹Œì§€, JWT ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ì´ ëë‚¬ìŠµë‹ˆë‹¤!<br/>\r\nJWT ì¸ì¦ì€ í•´ë„ í•´ë„ ì–´ë ¤ìš´ ê²ƒ ê°™ì•„ìš”ğŸ˜¥ ë‹¤ìŒì—ëŠ” REACT í™˜ê²½ì—ì„œ JWT ì¸ì¦ì„ êµ¬í˜„í•´ ë³´ëŠ” ê²ƒë„ ë„ì „í•´ ë³´ê¸°ë¡œ!</p>\n<p>ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” AWS í”„ë¦¬í‹°ì–´ë¥¼ ì´ìš©í•´ì„œ ì›¹ í˜¸ìŠ¤íŒ… ì„œë²„ë¥¼ ë§Œë“œëŠ” ê³¼ì •ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<p>ê°€ë³´ìê³ ~!ğŸ’¨</p>\n<hr>\n<h4>ì°¸ê³  ìë£Œ</h4>\n<ul>\n<li>\n<p><a href=\"https://www.youtube.com/watch?v=SnoAwLP1a-0&#x26;list=PL4cUxeGkcC9iqqESP8335DA5cRFp8loyp\">https://www.youtube.com/watch?v=SnoAwLP1a-0&#x26;list=PL4cUxeGkcC9iqqESP8335DA5cRFp8loyp</a></p>\n</li>\n<li>\n<p><a href=\"https://velopert.com/2448\">https://velopert.com/2448</a></p>\n</li>\n<li>\n<p><a href=\"https://inpa.tistory.com/entry/WEB-%F0%9F%93%9A-JWTjson-web-token-%EB%9E%80-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC\">https://inpa.tistory.com/entry/WEB-ğŸ“š-JWTjson-web-token-ë€-ğŸ’¯-ì •ë¦¬</a></p>\n</li>\n<li>\n<p><a href=\"https://www.daleseo.com/js-jwt/\">https://www.daleseo.com/js-jwt/</a></p>\n</li>\n</ul>","frontmatter":{"title":"Node.js + Express + JWT ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„í•˜ê¸°(feat. MongoDB)","date":"July 14, 2023","description":"Node.jsì™€ Express, Mongodbë¥¼ ì´ìš©í•œ JWT í† í° ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬í˜„ í•œ ë’¤, AWS ec2ë¥¼ í†µí•´ ë°°í¬í•œ ë‚´ìš©ì„ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.","tags":["Node.js","Express","JWT","Auth"]}},"previous":{"fields":{"slug":"/custom-gatsby-blog/"},"frontmatter":{"title":"Gatsby ë¸”ë¡œê·¸ ê¾¸ë¯¸ê¸°"}},"next":{"fields":{"slug":"/aws-ec2-hosting/"},"frontmatter":{"title":"AWS í”„ë¦¬í‹°ì–´ EC2ì™€ Github ì—°ë™í•˜ê¸°"}}},"pageContext":{"id":"b54a6070-dbd7-5ce7-ac9c-21d9aad67db7","previousPostId":"6f17cd8f-fbaa-5195-a916-c16af7bc28d7","nextPostId":"1403beec-17fa-5740-bb74-db292102feab"}},"staticQueryHashes":["2837417301","2841359383"],"slicesMap":{}}